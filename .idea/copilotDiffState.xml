<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/docs/Main.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/docs/Main.md" />
              <option name="updatedContent" value="# Main.java&#10;&#10;This file contains the main entry point for the Spring Boot application.&#10;&#10;```java&#10;package org.example;&#10;&#10;import org.springframework.boot.SpringApplication;&#10;import org.springframework.boot.autoconfigure.SpringBootApplication;&#10;import org.springframework.scheduling.annotation.EnableScheduling;&#10;import org.springframework.cache.annotation.EnableCaching;&#10;&#10;@SpringBootApplication&#10;@EnableScheduling&#10;@EnableCaching&#10;public class Main {&#10;    public static void main(String[] args) {&#10;        SpringApplication.run(Main.class, args);&#10;    }&#10;}&#10;```&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/myteam-ui/src/pages/Dashboard.tsx">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/myteam-ui/src/pages/Dashboard.tsx" />
              <option name="originalContent" value="import React, { useEffect, useState } from 'react';&#10;import axios from 'axios';&#10;import Sidebar from '../components/Sidebar';&#10;import { ComposedChart, Bar, Line, XAxis, YAxis, Tooltip, Legend, ResponsiveContainer, CartesianGrid } from 'recharts';&#10;import { PieChart, Pie, Cell } from 'recharts';&#10;&#10;const SIDEBAR_WIDTH = 180;&#10;&#10;const ROLE_COLORS = {&#10;  employee: '#8884d8',&#10;  teamlead: '#82ca9d',&#10;  manager: '#ffc658',&#10;  unknown: '#d0d0d0',&#10;};&#10;&#10;const Dashboard: React.FC = () =&gt; {&#10;  // Metrics&#10;  const [metrics, setMetrics] = useState({&#10;    totalRecognitions: 0,&#10;    totalEmployees: 0,&#10;    topSender: '-',&#10;    topReceiver: '-',&#10;  });&#10;  // Recent activity&#10;  const [recentRecognitions, setRecentRecognitions] = useState&lt;any[]&gt;([]);&#10;  // Graph data for last 6 months&#10;  const [graphData, setGraphData] = useState&lt;any[]&gt;([]);&#10;  // Pie chart data for recognitions by role&#10;  const [pieData, setPieData] = useState&lt;any[]&gt;([]);&#10;  const [selectedRole, setSelectedRole] = useState&lt;string | null&gt;(null);&#10;  const [selectedMonth, setSelectedMonth] = useState&lt;string | null&gt;(null);&#10;  // Store all recognitions for filtering&#10;  const [allRecognitions, setAllRecognitions] = useState&lt;any[]&gt;([]);&#10;&#10;  useEffect(() =&gt; {&#10;    // Fetch total recognitions&#10;    axios.get('/metrics/summary').then(res =&gt; {&#10;      const totals = res.data.totals || {};&#10;      setMetrics(prev =&gt; ({&#10;        ...prev,&#10;        totalRecognitions: totals.count || 0,&#10;      }));&#10;    }).catch(() =&gt; {&#10;      setMetrics(prev =&gt; ({ ...prev, totalRecognitions: 0 }));&#10;    });&#10;    // Fetch total employees&#10;    axios.get('/employees?page=0&amp;size=1').then(res =&gt; {&#10;      let total = 0;&#10;      if (res.data &amp;&amp; typeof res.data.totalElements === 'number') {&#10;        total = res.data.totalElements;&#10;      } else if (Array.isArray(res.data)) {&#10;        total = res.data.length;&#10;      }&#10;      setMetrics(prev =&gt; ({ ...prev, totalEmployees: total }));&#10;    }).catch(() =&gt; {&#10;      setMetrics(prev =&gt; ({ ...prev, totalEmployees: 0 }));&#10;    });&#10;    // Fetch top sender&#10;    axios.get('/leaderboard/top-senders?page=0&amp;size=1').then(res =&gt; {&#10;      let name = '-';&#10;      if (res.data) {&#10;        if (Array.isArray(res.data)) {&#10;          if (res.data.length &gt; 0 &amp;&amp; res.data[0].name) {&#10;            name = res.data[0].name;&#10;          }&#10;        } else if (Array.isArray(res.data.content)) {&#10;          if (res.data.content.length &gt; 0 &amp;&amp; res.data.content[0].name) {&#10;            name = res.data.content[0].name;&#10;          }&#10;        } else if (res.data.name) {&#10;          name = res.data.name;&#10;        }&#10;      }&#10;      console.log('Top Sender API response:', res.data, 'Parsed:', name);&#10;      setMetrics(prev =&gt; ({ ...prev, topSender: name !== '-' ? name : 'No data' }));&#10;    }).catch(err =&gt; {&#10;      console.log('Top Sender API error:', err);&#10;      setMetrics(prev =&gt; ({ ...prev, topSender: 'No data' }));&#10;    });&#10;    // Fetch top receiver (correct endpoint)&#10;    axios.get('/leaderboard/top-recipients?page=0&amp;size=1').then(res =&gt; {&#10;      let name = '-';&#10;      if (res.data &amp;&amp; Array.isArray(res.data.content) &amp;&amp; res.data.content.length &gt; 0) {&#10;        name = res.data.content[0].name || '-';&#10;      }&#10;      console.log('Top Receiver API response:', res.data, 'Parsed:', name);&#10;      setMetrics(prev =&gt; ({ ...prev, topReceiver: name !== '-' ? name : 'No data' }));&#10;    }).catch(err =&gt; {&#10;      console.log('Top Receiver API error:', err);&#10;      setMetrics(prev =&gt; ({ ...prev, topReceiver: 'No data' }));&#10;    });&#10;    axios.get('/recognitions?page=0&amp;size=10').then(res =&gt; {&#10;      setRecentRecognitions(res.data);&#10;    }).catch(() =&gt; {&#10;      setRecentRecognitions([]);&#10;    });&#10;    // Fetch all recognitions for filtering&#10;    axios.get('/recognitions?page=0&amp;size=1000').then(res =&gt; {&#10;      const data = Array.isArray(res.data) ? res.data : (res.data.content || []);&#10;      setAllRecognitions(data);&#10;      // Aggregate by month for graph&#10;      const monthMap: { [key: string]: { recognitions: number; points: number } } = {};&#10;      data.forEach((rec: any) =&gt; {&#10;        if (!rec.sentAt) return;&#10;        const date = new Date(rec.sentAt * 1000);&#10;        const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;&#10;        if (!monthMap[key]) monthMap[key] = { recognitions: 0, points: 0 };&#10;        monthMap[key].recognitions += 1;&#10;        monthMap[key].points += rec.awardPoints || 0;&#10;      });&#10;      const sortedKeys = Object.keys(monthMap).sort((a, b) =&gt; b.localeCompare(a));&#10;      const last6 = sortedKeys.slice(0, 6).reverse();&#10;      const chartData = last6.map(key =&gt; ({&#10;        month: key,&#10;        recognitions: monthMap[key].recognitions,&#10;        points: monthMap[key].points,&#10;      }));&#10;      setGraphData(chartData);&#10;      // Aggregate by role for pie chart&#10;      const roleMap: { [key: string]: number } = {};&#10;      data.forEach((rec: any) =&gt; {&#10;        const role = rec.recipientRole || 'unknown';&#10;        roleMap[role] = (roleMap[role] || 0) + 1;&#10;      });&#10;      const pieChartData = Object.keys(roleMap).map(role =&gt; ({&#10;        name: role.charAt(0).toUpperCase() + role.slice(1),&#10;        value: roleMap[role],&#10;        role,&#10;      }));&#10;      setPieData(pieChartData);&#10;    }).catch(() =&gt; {&#10;      setAllRecognitions([]);&#10;      setGraphData([]);&#10;      setPieData([]);&#10;    });&#10;  }, []);&#10;&#10;  // Filtered pie chart data based on selected month and role&#10;  const filteredPieData = React.useMemo(() =&gt; {&#10;    let filtered = allRecognitions;&#10;    if (selectedMonth) {&#10;      filtered = filtered.filter((rec: any) =&gt; {&#10;        if (!rec.sentAt) return false;&#10;        const date = new Date(rec.sentAt * 1000);&#10;        const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;&#10;        return key === selectedMonth;&#10;      });&#10;    }&#10;    if (selectedRole) {&#10;      filtered = filtered.filter((rec: any) =&gt; rec.recipientRole === selectedRole);&#10;    }&#10;    // Aggregate by role&#10;    const roleMap: { [key: string]: number } = {};&#10;    filtered.forEach((rec: any) =&gt; {&#10;      const role = rec.recipientRole || 'unknown';&#10;      roleMap[role] = (roleMap[role] || 0) + 1;&#10;    });&#10;    return Object.keys(roleMap).map(role =&gt; ({&#10;      name: role.charAt(0).toUpperCase() + role.slice(1),&#10;      value: roleMap[role],&#10;      role,&#10;    }));&#10;  }, [allRecognitions, selectedMonth, selectedRole]);&#10;&#10;  // Filtered graph data based on selected role&#10;  const filteredGraphData = React.useMemo(() =&gt; {&#10;    let filtered = allRecognitions;&#10;    if (selectedRole) {&#10;      filtered = filtered.filter((rec: any) =&gt; rec.recipientRole === selectedRole);&#10;    }&#10;    // Aggregate by month&#10;    const monthMap: { [key: string]: { recognitions: number; points: number } } = {};&#10;    filtered.forEach((rec: any) =&gt; {&#10;      if (!rec.sentAt) return;&#10;      const date = new Date(rec.sentAt * 1000);&#10;      const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;&#10;      if (!monthMap[key]) monthMap[key] = { recognitions: 0, points: 0 };&#10;      monthMap[key].recognitions += 1;&#10;      monthMap[key].points += rec.awardPoints || 0;&#10;    });&#10;    const sortedKeys = Object.keys(monthMap).sort((a, b) =&gt; b.localeCompare(a));&#10;    const last6 = sortedKeys.slice(0, 6).reverse();&#10;    return last6.map(key =&gt; ({&#10;      month: key,&#10;      recognitions: monthMap[key].recognitions,&#10;      points: monthMap[key].points,&#10;    }));&#10;  }, [selectedRole, allRecognitions]);&#10;&#10;  // Track active pie segment for highlight&#10;  const activeIndex = selectedRole&#10;    ? filteredPieData.findIndex(d =&gt; d.role === selectedRole)&#10;    : undefined;&#10;&#10;  // Pie click handler&#10;  const handlePieClick = (_: any, idx: number) =&gt; {&#10;    const role = filteredPieData[idx]?.role;&#10;    if (!role) return;&#10;    setSelectedRole(prev =&gt; (prev === role ? null : role));&#10;  };&#10;&#10;  // Graph click handler&#10;  const handleGraphClick = (data: any, idx: number) =&gt; {&#10;    const month = data &amp;&amp; data.activeLabel;&#10;    if (!month) return;&#10;    setSelectedMonth(prev =&gt; (prev === month ? null : month));&#10;  };&#10;&#10;  // Reset filter buttons&#10;  const handleResetRoleFilter = () =&gt; setSelectedRole(null);&#10;  const handleResetMonthFilter = () =&gt; setSelectedMonth(null);&#10;&#10;  return (&#10;    &lt;div style={{ width: '100vw', minHeight: '100vh', display: 'flex', background: '#f5f7fa' }}&gt;&#10;      &lt;div style={{ width: SIDEBAR_WIDTH, minWidth: SIDEBAR_WIDTH, height: '100vh', position: 'relative', zIndex: 2 }}&gt;&#10;        &lt;Sidebar /&gt;&#10;      &lt;/div&gt;&#10;      &lt;div style={{ flex: 1, padding: 32, display: 'flex', flexDirection: 'column', alignItems: 'center', background: '#f5f7fa', borderRadius: 12, boxShadow: '0 4px 16px #e0e0e0', minHeight: '100vh' }}&gt;&#10;        &lt;h2 style={{ textAlign: 'center', marginBottom: 18, fontSize: '1.3rem', fontWeight: 600 }}&gt;Dashboard&lt;/h2&gt;&#10;        {/* Metrics Section - moved above graph */}&#10;        &lt;div style={{ display: 'flex', gap: 24, marginBottom: 24, width: '100%', justifyContent: 'center' }}&gt;&#10;          &lt;div style={{ background: '#fff', borderRadius: 8, boxShadow: '0 2px 8px #e0e0e0', padding: 18, minWidth: 160, textAlign: 'center' }}&gt;&#10;            &lt;div style={{ fontSize: '0.8rem', color: '#888' }}&gt;Total Recognitions&lt;/div&gt;&#10;            &lt;div style={{ fontSize: '1.2rem', fontWeight: 700 }}&gt;{metrics.totalRecognitions}&lt;/div&gt;&#10;          &lt;/div&gt;&#10;          &lt;div style={{ background: '#fff', borderRadius: 8, boxShadow: '0 2px 8px #e0e0e0', padding: 18, minWidth: 160, textAlign: 'center' }}&gt;&#10;            &lt;div style={{ fontSize: '0.8rem', color: '#888' }}&gt;Total Employees&lt;/div&gt;&#10;            &lt;div style={{ fontSize: '1.2rem', fontWeight: 700 }}&gt;{metrics.totalEmployees}&lt;/div&gt;&#10;          &lt;/div&gt;&#10;          &lt;div style={{ background: '#fff', borderRadius: 8, boxShadow: '0 2px 8px #e0e0e0', padding: 18, minWidth: 160, textAlign: 'center' }}&gt;&#10;            &lt;div style={{ fontSize: '0.8rem', color: '#888' }}&gt;Top Sender&lt;/div&gt;&#10;            &lt;div style={{ fontSize: '1rem', fontWeight: 600 }}&gt;{metrics.topSender !== '-' ? metrics.topSender : 'No data'}&lt;/div&gt;&#10;          &lt;/div&gt;&#10;          &lt;div style={{ background: '#fff', borderRadius: 8, boxShadow: '0 2px 8px #e0e0e0', padding: 18, minWidth: 160, textAlign: 'center' }}&gt;&#10;            &lt;div style={{ fontSize: '0.8rem', color: '#888' }}&gt;Top Receiver&lt;/div&gt;&#10;            &lt;div style={{ fontSize: '1rem', fontWeight: 600 }}&gt;{metrics.topReceiver !== '-' ? metrics.topReceiver : 'No data'}&lt;/div&gt;&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;        {/* Pie Chart Section */}&#10;        &lt;div style={{ width: '100%', maxWidth: 700, background: '#fff', borderRadius: 8, boxShadow: '0 2px 8px #e0e0e0', padding: 18, marginBottom: 24 }}&gt;&#10;          &lt;div style={{ fontWeight: 600, marginBottom: 8 }}&gt;Recognitions by Recipient Role&lt;/div&gt;&#10;          {(selectedRole || selectedMonth) &amp;&amp; (&#10;            &lt;div style={{ marginBottom: 8 }}&gt;&#10;              {selectedRole &amp;&amp; (&#10;                &lt;button onClick={handleResetRoleFilter} style={{ marginRight: 8, padding: '4px 12px', borderRadius: 4, border: '1px solid #888', background: '#f5f7fa', cursor: 'pointer' }}&gt;&#10;                  Reset Role Filter&#10;                &lt;/button&gt;&#10;              )}&#10;              {selectedMonth &amp;&amp; (&#10;                &lt;button onClick={handleResetMonthFilter} style={{ padding: '4px 12px', borderRadius: 4, border: '1px solid #888', background: '#f5f7fa', cursor: 'pointer' }}&gt;&#10;                  Reset Month Filter&#10;                &lt;/button&gt;&#10;              )}&#10;            &lt;/div&gt;&#10;          )}&#10;          &lt;ResponsiveContainer width=&quot;100%&quot; height={220}&gt;&#10;            &lt;PieChart&gt;&#10;              &lt;Pie&#10;                data={filteredPieData}&#10;                dataKey=&quot;value&quot;&#10;                nameKey=&quot;name&quot;&#10;                cx=&quot;50%&quot;&#10;                cy=&quot;50%&quot;&#10;                outerRadius={80}&#10;                label={({ name, value }) =&gt; `${name}: ${value}`}&#10;                activeIndex={activeIndex}&#10;                onClick={handlePieClick}&#10;              &gt;&#10;                {filteredPieData.map((entry, idx) =&gt; {&#10;                  const validRoles = ['employee', 'teamlead', 'manager', 'unknown'] as const;&#10;                  const roleKey = validRoles.includes(entry.role as typeof validRoles[number])&#10;                    ? (entry.role as typeof validRoles[number])&#10;                    : 'unknown';&#10;                  return (&#10;                    &lt;Cell key={`cell-${idx}`} fill={ROLE_COLORS[roleKey]} /&gt;&#10;                  );&#10;                })}&#10;              &lt;/Pie&gt;&#10;            &lt;/PieChart&gt;&#10;          &lt;/ResponsiveContainer&gt;&#10;        &lt;/div&gt;&#10;        {/* Graph Section */}&#10;        &lt;div style={{ width: '100%', maxWidth: 700, background: '#fff', borderRadius: 8, boxShadow: '0 2px 8px #e0e0e0', padding: 18, marginBottom: 24 }}&gt;&#10;          &lt;div style={{ fontWeight: 600, marginBottom: 8 }}&gt;&#10;            Recognitions &amp; Points (Last 6 Months)&#10;            {selectedRole &amp;&amp; (&#10;              &lt;span style={{ marginLeft: 12, color: '#888', fontWeight: 400 }}&gt;&#10;                (Filtered by role: &lt;b&gt;{selectedRole.charAt(0).toUpperCase() + selectedRole.slice(1)}&lt;/b&gt;)&#10;              &lt;/span&gt;&#10;            )}&#10;            {selectedMonth &amp;&amp; (&#10;              &lt;span style={{ marginLeft: 12, color: '#888', fontWeight: 400 }}&gt;&#10;                (Filtered by month: &lt;b&gt;{selectedMonth}&lt;/b&gt;)&#10;              &lt;/span&gt;&#10;            )}&#10;          &lt;/div&gt;&#10;          &lt;ResponsiveContainer width=&quot;100%&quot; height={280}&gt;&#10;            &lt;ComposedChart data={filteredGraphData} margin={{ top: 20, right: 30, left: 0, bottom: 0 }} onClick={handleGraphClick}&gt;&#10;              &lt;CartesianGrid stroke=&quot;#f5f5f5&quot; /&gt;&#10;              &lt;XAxis dataKey=&quot;month&quot; /&gt;&#10;              &lt;YAxis yAxisId=&quot;left&quot; orientation=&quot;left&quot; stroke=&quot;#8884d8&quot; /&gt;&#10;              &lt;YAxis yAxisId=&quot;right&quot; orientation=&quot;right&quot; stroke=&quot;#82ca9d&quot; /&gt;&#10;              &lt;Tooltip /&gt;&#10;              &lt;Legend /&gt;&#10;              &lt;Bar yAxisId=&quot;left&quot; dataKey=&quot;recognitions&quot; name=&quot;Recognitions&quot; fill=&quot;#8884d8&quot; barSize={32} /&gt;&#10;              &lt;Line yAxisId=&quot;right&quot; type=&quot;monotone&quot; dataKey=&quot;points&quot; name=&quot;Points&quot; stroke=&quot;#82ca9d&quot; strokeWidth={3} dot={{ r: 4 }} /&gt;&#10;            &lt;/ComposedChart&gt;&#10;          &lt;/ResponsiveContainer&gt;&#10;        &lt;/div&gt;&#10;        {/* Recent Recognitions Table */}&#10;        &lt;div style={{ width: '100%', background: '#fff', borderRadius: 8, boxShadow: '0 2px 8px #e0e0e0', padding: 18 }}&gt;&#10;          &lt;div style={{ fontWeight: 600, marginBottom: 8 }}&gt;Recent Recognitions&lt;/div&gt;&#10;          &lt;table style={{ width: '100%', fontSize: '0.8rem', background: '#fff', borderRadius: 8 }}&gt;&#10;            &lt;thead&gt;&#10;              &lt;tr style={{ background: '#8da1bd' }}&gt;&#10;                &lt;th style={{ padding: 8, textAlign: 'left', fontWeight: 600 }}&gt;Sender&lt;/th&gt;&#10;                &lt;th style={{ padding: 8, textAlign: 'left', fontWeight: 600 }}&gt;Receiver&lt;/th&gt;&#10;                &lt;th style={{ padding: 8, textAlign: 'left', fontWeight: 600 }}&gt;Type&lt;/th&gt;&#10;                &lt;th style={{ padding: 8, textAlign: 'left', fontWeight: 600 }}&gt;Category&lt;/th&gt;&#10;                &lt;th style={{ padding: 8, textAlign: 'left', fontWeight: 600 }}&gt;Level&lt;/th&gt;&#10;                &lt;th style={{ padding: 8, textAlign: 'left', fontWeight: 600 }}&gt;Points&lt;/th&gt;&#10;                &lt;th style={{ padding: 8, textAlign: 'left', fontWeight: 600 }}&gt;Date&lt;/th&gt;&#10;              &lt;/tr&gt;&#10;            &lt;/thead&gt;&#10;            &lt;tbody&gt;&#10;              {recentRecognitions.length === 0 ? (&#10;                &lt;tr&gt;&lt;td colSpan={7} style={{ padding: 8, textAlign: 'center', color: '#888' }}&gt;No recent recognitions found.&lt;/td&gt;&lt;/tr&gt;&#10;              ) : recentRecognitions.map((row, idx) =&gt; {&#10;                const sender = row.senderName || '-';&#10;                const receiver = row.recipientName || '-';&#10;                const type = row.recognitionTypeName || '-';&#10;                const category = row.category || '-';&#10;                const level = row.level || '-';&#10;                const points = row.awardPoints != null ? row.awardPoints : '-';&#10;                let dateStr = '-';&#10;                if (row.sentAt) {&#10;                  try {&#10;                    const date = new Date(row.sentAt * 1000);&#10;                    dateStr = `${String(date.getDate()).padStart(2, '0')}/${String(date.getMonth() + 1).padStart(2, '0')}/${date.getFullYear()}`;&#10;                  } catch {&#10;                    dateStr = '-';&#10;                  }&#10;                }&#10;                return (&#10;                  &lt;tr key={idx} style={{ background: idx % 2 === 0 ? '#f5f7fa' : '#fff' }}&gt;&#10;                    &lt;td style={{ padding: 8 }}&gt;{sender}&lt;/td&gt;&#10;                    &lt;td style={{ padding: 8 }}&gt;{receiver}&lt;/td&gt;&#10;                    &lt;td style={{ padding: 8 }}&gt;{type}&lt;/td&gt;&#10;                    &lt;td style={{ padding: 8 }}&gt;{category}&lt;/td&gt;&#10;                    &lt;td style={{ padding: 8 }}&gt;{level}&lt;/td&gt;&#10;                    &lt;td style={{ padding: 8 }}&gt;{points}&lt;/td&gt;&#10;                    &lt;td style={{ padding: 8 }}&gt;{dateStr}&lt;/td&gt;&#10;                  &lt;/tr&gt;&#10;                );&#10;              })}&#10;            &lt;/tbody&gt;&#10;          &lt;/table&gt;&#10;        &lt;/div&gt;&#10;      &lt;/div&gt;&#10;    &lt;/div&gt;&#10;  );&#10;};&#10;&#10;export default Dashboard;&#10;&#10;" />
              <option name="updatedContent" value="import React, { useEffect, useState } from 'react';&#10;import axios from 'axios';&#10;import Sidebar from '../components/Sidebar';&#10;import { ComposedChart, Bar, Line, XAxis, YAxis, Tooltip, Legend, ResponsiveContainer, CartesianGrid } from 'recharts';&#10;import { PieChart, Pie, Cell } from 'recharts';&#10;&#10;const SIDEBAR_WIDTH = 180;&#10;&#10;const ROLE_COLORS = {&#10;  employee: '#8884d8',&#10;  teamlead: '#82ca9d',&#10;  manager: '#ffc658',&#10;  unknown: '#d0d0d0',&#10;};&#10;&#10;const Dashboard: React.FC = () =&gt; {&#10;  // Metrics&#10;  const [metrics, setMetrics] = useState({&#10;    totalRecognitions: 0,&#10;    totalEmployees: 0,&#10;    topSender: '-',&#10;    topReceiver: '-',&#10;  });&#10;  // Recent activity&#10;  const [recentRecognitions, setRecentRecognitions] = useState&lt;any[]&gt;([]);&#10;  // Graph data for last 6 months&#10;  const [graphData, setGraphData] = useState&lt;any[]&gt;([]);&#10;  // Pie chart data for recognitions by role&#10;  const [pieData, setPieData] = useState&lt;any[]&gt;([]);&#10;  const [selectedRole, setSelectedRole] = useState&lt;string | null&gt;(null);&#10;  const [selectedMonth, setSelectedMonth] = useState&lt;string | null&gt;(null);&#10;  // Store all recognitions for filtering&#10;  const [allRecognitions, setAllRecognitions] = useState&lt;any[]&gt;([]);&#10;&#10;  useEffect(() =&gt; {&#10;    // Fetch total recognitions&#10;    axios.get('/metrics/summary').then(res =&gt; {&#10;      const totals = res.data.totals || {};&#10;      setMetrics(prev =&gt; ({&#10;        ...prev,&#10;        totalRecognitions: totals.count || 0,&#10;      }));&#10;    }).catch(() =&gt; {&#10;      setMetrics(prev =&gt; ({ ...prev, totalRecognitions: 0 }));&#10;    });&#10;    // Fetch total employees&#10;    axios.get('/employees?page=0&amp;size=1').then(res =&gt; {&#10;      let total = 0;&#10;      if (res.data &amp;&amp; typeof res.data.totalElements === 'number') {&#10;        total = res.data.totalElements;&#10;      } else if (Array.isArray(res.data)) {&#10;        total = res.data.length;&#10;      }&#10;      setMetrics(prev =&gt; ({ ...prev, totalEmployees: total }));&#10;    }).catch(() =&gt; {&#10;      setMetrics(prev =&gt; ({ ...prev, totalEmployees: 0 }));&#10;    });&#10;    // Fetch top sender&#10;    axios.get('/leaderboard/top-senders?page=0&amp;size=1').then(res =&gt; {&#10;      let name = '-';&#10;      if (res.data) {&#10;        if (Array.isArray(res.data)) {&#10;          if (res.data.length &gt; 0 &amp;&amp; res.data[0].name) {&#10;            name = res.data[0].name;&#10;          }&#10;        } else if (Array.isArray(res.data.content)) {&#10;          if (res.data.content.length &gt; 0 &amp;&amp; res.data.content[0].name) {&#10;            name = res.data.content[0].name;&#10;          }&#10;        } else if (res.data.name) {&#10;          name = res.data.name;&#10;        }&#10;      }&#10;      console.log('Top Sender API response:', res.data, 'Parsed:', name);&#10;      setMetrics(prev =&gt; ({ ...prev, topSender: name !== '-' ? name : 'No data' }));&#10;    }).catch(err =&gt; {&#10;      console.log('Top Sender API error:', err);&#10;      setMetrics(prev =&gt; ({ ...prev, topSender: 'No data' }));&#10;    });&#10;    // Fetch top receiver (correct endpoint)&#10;    axios.get('/leaderboard/top-recipients?page=0&amp;size=1').then(res =&gt; {&#10;      let name = '-';&#10;      if (res.data &amp;&amp; Array.isArray(res.data.content) &amp;&amp; res.data.content.length &gt; 0) {&#10;        name = res.data.content[0].name || '-';&#10;      }&#10;      console.log('Top Receiver API response:', res.data, 'Parsed:', name);&#10;      setMetrics(prev =&gt; ({ ...prev, topReceiver: name !== '-' ? name : 'No data' }));&#10;    }).catch(err =&gt; {&#10;      console.log('Top Receiver API error:', err);&#10;      setMetrics(prev =&gt; ({ ...prev, topReceiver: 'No data' }));&#10;    });&#10;    axios.get('/recognitions?page=0&amp;size=10').then(res =&gt; {&#10;      setRecentRecognitions(res.data);&#10;    }).catch(() =&gt; {&#10;      setRecentRecognitions([]);&#10;    });&#10;    // Fetch all recognitions for filtering&#10;    axios.get('/recognitions?page=0&amp;size=1000').then(res =&gt; {&#10;      const data = Array.isArray(res.data) ? res.data : (res.data.content || []);&#10;      setAllRecognitions(data);&#10;      // Aggregate by month for graph&#10;      const monthMap: { [key: string]: { recognitions: number; points: number } } = {};&#10;      data.forEach((rec: any) =&gt; {&#10;        if (!rec.sentAt) return;&#10;        const date = new Date(rec.sentAt * 1000);&#10;        const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;&#10;        if (!monthMap[key]) monthMap[key] = { recognitions: 0, points: 0 };&#10;        monthMap[key].recognitions += 1;&#10;        monthMap[key].points += rec.awardPoints || 0;&#10;      });&#10;      const sortedKeys = Object.keys(monthMap).sort((a, b) =&gt; b.localeCompare(a));&#10;      const last12 = sortedKeys.slice(0, 12).reverse();&#10;      const chartData = last12.map(key =&gt; ({&#10;        month: key,&#10;        recognitions: monthMap[key].recognitions,&#10;        points: monthMap[key].points,&#10;      }));&#10;      setGraphData(chartData);&#10;      // Aggregate by role for pie chart&#10;      const roleMap: { [key: string]: number } = {};&#10;      data.forEach((rec: any) =&gt; {&#10;        const role = rec.recipientRole || 'unknown';&#10;        roleMap[role] = (roleMap[role] || 0) + 1;&#10;      });&#10;      const pieChartData = Object.keys(roleMap).map(role =&gt; ({&#10;        name: role.charAt(0).toUpperCase() + role.slice(1),&#10;        value: roleMap[role],&#10;        role,&#10;      }));&#10;      setPieData(pieChartData);&#10;    }).catch(() =&gt; {&#10;      setAllRecognitions([]);&#10;      setGraphData([]);&#10;      setPieData([]);&#10;    });&#10;  }, []);&#10;&#10;  // Filtered pie chart data based on selected month and role&#10;  const filteredPieData = React.useMemo(() =&gt; {&#10;    let filtered = allRecognitions;&#10;    if (selectedMonth) {&#10;      filtered = filtered.filter((rec: any) =&gt; {&#10;        if (!rec.sentAt) return false;&#10;        const date = new Date(rec.sentAt * 1000);&#10;        const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;&#10;        return key === selectedMonth;&#10;      });&#10;    }&#10;    if (selectedRole) {&#10;      filtered = filtered.filter((rec: any) =&gt; rec.recipientRole === selectedRole);&#10;    }&#10;    // Aggregate by role&#10;    const roleMap: { [key: string]: number } = {};&#10;    filtered.forEach((rec: any) =&gt; {&#10;      const role = rec.recipientRole || 'unknown';&#10;      roleMap[role] = (roleMap[role] || 0) + 1;&#10;    });&#10;    return Object.keys(roleMap).map(role =&gt; ({&#10;      name: role.charAt(0).toUpperCase() + role.slice(1),&#10;      value: roleMap[role],&#10;      role,&#10;    }));&#10;  }, [allRecognitions, selectedMonth, selectedRole]);&#10;&#10;  // Filtered graph data based on selected role&#10;  const filteredGraphData = React.useMemo(() =&gt; {&#10;    let filtered = allRecognitions;&#10;    if (selectedRole) {&#10;      filtered = filtered.filter((rec: any) =&gt; rec.recipientRole === selectedRole);&#10;    }&#10;    // Aggregate by month&#10;    const monthMap: { [key: string]: { recognitions: number; points: number } } = {};&#10;    filtered.forEach((rec: any) =&gt; {&#10;      if (!rec.sentAt) return;&#10;      const date = new Date(rec.sentAt * 1000);&#10;      const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;&#10;      if (!monthMap[key]) monthMap[key] = { recognitions: 0, points: 0 };&#10;      monthMap[key].recognitions += 1;&#10;      monthMap[key].points += rec.awardPoints || 0;&#10;    });&#10;    const sortedKeys = Object.keys(monthMap).sort((a, b) =&gt; b.localeCompare(a));&#10;    const last12 = sortedKeys.slice(0, 12).reverse();&#10;    return last12.map(key =&gt; ({&#10;      month: key,&#10;      recognitions: monthMap[key].recognitions,&#10;      points: monthMap[key].points,&#10;    }));&#10;  }, [selectedRole, allRecognitions]);&#10;&#10;  // Track active pie segment for highlight&#10;  const activeIndex = selectedRole&#10;    ? filteredPieData.findIndex(d =&gt; d.role === selectedRole)&#10;    : undefined;&#10;&#10;  // Pie click handler&#10;  const handlePieClick = (_: any, idx: number) =&gt; {&#10;    const role = filteredPieData[idx]?.role;&#10;    if (!role) return;&#10;    setSelectedRole(prev =&gt; (prev === role ? null : role));&#10;  };&#10;&#10;  // Graph click handler&#10;  const handleGraphClick = (data: any, idx: number) =&gt; {&#10;    const month = data &amp;&amp; data.activeLabel;&#10;    if (!month) return;&#10;    setSelectedMonth(prev =&gt; (prev === month ? null : month));&#10;  };&#10;&#10;  // Reset filter buttons&#10;  const handleResetRoleFilter = () =&gt; setSelectedRole(null);&#10;  const handleResetMonthFilter = () =&gt; setSelectedMonth(null);&#10;&#10;  return (&#10;    &lt;div style={{ width: '100vw', minHeight: '100vh', display: 'flex', background: '#f5f7fa' }}&gt;&#10;      &lt;div style={{ width: SIDEBAR_WIDTH, minWidth: SIDEBAR_WIDTH, height: '100vh', position: 'relative', zIndex: 2 }}&gt;&#10;        &lt;Sidebar /&gt;&#10;      &lt;/div&gt;&#10;      &lt;div style={{ flex: 1, padding: 32, display: 'flex', flexDirection: 'column', alignItems: 'center', background: '#f5f7fa', borderRadius: 12, boxShadow: '0 4px 16px #e0e0e0', minHeight: '100vh' }}&gt;&#10;        &lt;h2 style={{ textAlign: 'center', marginBottom: 18, fontSize: '1.3rem', fontWeight: 600 }}&gt;Dashboard&lt;/h2&gt;&#10;        {/* Metrics Section - moved above graph */}&#10;        &lt;div style={{ display: 'flex', gap: 24, marginBottom: 24, width: '100%', justifyContent: 'center' }}&gt;&#10;          &lt;div style={{ background: '#fff', borderRadius: 8, boxShadow: '0 2px 8px #e0e0e0', padding: 18, minWidth: 160, textAlign: 'center' }}&gt;&#10;            &lt;div style={{ fontSize: '0.8rem', color: '#888' }}&gt;Total Recognitions&lt;/div&gt;&#10;            &lt;div style={{ fontSize: '1.2rem', fontWeight: 700 }}&gt;{metrics.totalRecognitions}&lt;/div&gt;&#10;          &lt;/div&gt;&#10;          &lt;div style={{ background: '#fff', borderRadius: 8, boxShadow: '0 2px 8px #e0e0e0', padding: 18, minWidth: 160, textAlign: 'center' }}&gt;&#10;            &lt;div style={{ fontSize: '0.8rem', color: '#888' }}&gt;Total Employees&lt;/div&gt;&#10;            &lt;div style={{ fontSize: '1.2rem', fontWeight: 700 }}&gt;{metrics.totalEmployees}&lt;/div&gt;&#10;          &lt;/div&gt;&#10;          &lt;div style={{ background: '#fff', borderRadius: 8, boxShadow: '0 2px 8px #e0e0e0', padding: 18, minWidth: 160, textAlign: 'center' }}&gt;&#10;            &lt;div style={{ fontSize: '0.8rem', color: '#888' }}&gt;Top Sender&lt;/div&gt;&#10;            &lt;div style={{ fontSize: '1rem', fontWeight: 600 }}&gt;{metrics.topSender !== '-' ? metrics.topSender : 'No data'}&lt;/div&gt;&#10;          &lt;/div&gt;&#10;          &lt;div style={{ background: '#fff', borderRadius: 8, boxShadow: '0 2px 8px #e0e0e0', padding: 18, minWidth: 160, textAlign: 'center' }}&gt;&#10;            &lt;div style={{ fontSize: '0.8rem', color: '#888' }}&gt;Top Receiver&lt;/div&gt;&#10;            &lt;div style={{ fontSize: '1rem', fontWeight: 600 }}&gt;{metrics.topReceiver !== '-' ? metrics.topReceiver : 'No data'}&lt;/div&gt;&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;        {/* Pie Chart Section */}&#10;        &lt;div style={{ width: '100%', maxWidth: 700, background: '#fff', borderRadius: 8, boxShadow: '0 2px 8px #e0e0e0', padding: 18, marginBottom: 24 }}&gt;&#10;          &lt;div style={{ fontWeight: 600, marginBottom: 8 }}&gt;Recognitions by Recipient Role&lt;/div&gt;&#10;          {(selectedRole || selectedMonth) &amp;&amp; (&#10;            &lt;div style={{ marginBottom: 8 }}&gt;&#10;              {selectedRole &amp;&amp; (&#10;                &lt;button onClick={handleResetRoleFilter} style={{ marginRight: 8, padding: '4px 12px', borderRadius: 4, border: '1px solid #888', background: '#f5f7fa', cursor: 'pointer' }}&gt;&#10;                  Reset Role Filter&#10;                &lt;/button&gt;&#10;              )}&#10;              {selectedMonth &amp;&amp; (&#10;                &lt;button onClick={handleResetMonthFilter} style={{ padding: '4px 12px', borderRadius: 4, border: '1px solid #888', background: '#f5f7fa', cursor: 'pointer' }}&gt;&#10;                  Reset Month Filter&#10;                &lt;/button&gt;&#10;              )}&#10;            &lt;/div&gt;&#10;          )}&#10;          &lt;ResponsiveContainer width=&quot;100%&quot; height={220}&gt;&#10;            &lt;PieChart&gt;&#10;              &lt;Pie&#10;                data={filteredPieData}&#10;                dataKey=&quot;value&quot;&#10;                nameKey=&quot;name&quot;&#10;                cx=&quot;50%&quot;&#10;                cy=&quot;50%&quot;&#10;                outerRadius={80}&#10;                label={({ name, value }) =&gt; `${name}: ${value}`}&#10;                activeIndex={activeIndex}&#10;                onClick={handlePieClick}&#10;              &gt;&#10;                {filteredPieData.map((entry, idx) =&gt; {&#10;                  const validRoles = ['employee', 'teamlead', 'manager', 'unknown'] as const;&#10;                  const roleKey = validRoles.includes(entry.role as typeof validRoles[number])&#10;                    ? (entry.role as typeof validRoles[number])&#10;                    : 'unknown';&#10;                  return (&#10;                    &lt;Cell key={`cell-${idx}`} fill={ROLE_COLORS[roleKey]} /&gt;&#10;                  );&#10;                })}&#10;              &lt;/Pie&gt;&#10;            &lt;/PieChart&gt;&#10;          &lt;/ResponsiveContainer&gt;&#10;        &lt;/div&gt;&#10;        {/* Graph Section */}&#10;        &lt;div style={{ width: '100%', maxWidth: 700, background: '#fff', borderRadius: 8, boxShadow: '0 2px 8px #e0e0e0', padding: 18, marginBottom: 24 }}&gt;&#10;          &lt;div style={{ fontWeight: 600, marginBottom: 8 }}&gt;&#10;            Recognitions &amp; Points (Last 6 Months)&#10;            {selectedRole &amp;&amp; (&#10;              &lt;span style={{ marginLeft: 12, color: '#888', fontWeight: 400 }}&gt;&#10;                (Filtered by role: &lt;b&gt;{selectedRole.charAt(0).toUpperCase() + selectedRole.slice(1)}&lt;/b&gt;)&#10;              &lt;/span&gt;&#10;            )}&#10;            {selectedMonth &amp;&amp; (&#10;              &lt;span style={{ marginLeft: 12, color: '#888', fontWeight: 400 }}&gt;&#10;                (Filtered by month: &lt;b&gt;{selectedMonth}&lt;/b&gt;)&#10;              &lt;/span&gt;&#10;            )}&#10;          &lt;/div&gt;&#10;          &lt;ResponsiveContainer width=&quot;100%&quot; height={280}&gt;&#10;            &lt;ComposedChart data={filteredGraphData} margin={{ top: 20, right: 30, left: 0, bottom: 0 }} onClick={handleGraphClick}&gt;&#10;              &lt;CartesianGrid stroke=&quot;#f5f5f5&quot; /&gt;&#10;              &lt;XAxis dataKey=&quot;month&quot; /&gt;&#10;              &lt;YAxis yAxisId=&quot;left&quot; orientation=&quot;left&quot; stroke=&quot;#8884d8&quot; /&gt;&#10;              &lt;YAxis yAxisId=&quot;right&quot; orientation=&quot;right&quot; stroke=&quot;#82ca9d&quot; /&gt;&#10;              &lt;Tooltip /&gt;&#10;              &lt;Legend /&gt;&#10;              &lt;Bar yAxisId=&quot;left&quot; dataKey=&quot;recognitions&quot; name=&quot;Recognitions&quot; fill=&quot;#8884d8&quot; barSize={32} /&gt;&#10;              &lt;Line yAxisId=&quot;right&quot; type=&quot;monotone&quot; dataKey=&quot;points&quot; name=&quot;Points&quot; stroke=&quot;#82ca9d&quot; strokeWidth={3} dot={{ r: 4 }} /&gt;&#10;            &lt;/ComposedChart&gt;&#10;          &lt;/ResponsiveContainer&gt;&#10;        &lt;/div&gt;&#10;        {/* Recent Recognitions Table */}&#10;        &lt;div style={{ width: '100%', background: '#fff', borderRadius: 8, boxShadow: '0 2px 8px #e0e0e0', padding: 18 }}&gt;&#10;          &lt;div style={{ fontWeight: 600, marginBottom: 8 }}&gt;Recent Recognitions&lt;/div&gt;&#10;          &lt;table style={{ width: '100%', fontSize: '0.8rem', background: '#fff', borderRadius: 8 }}&gt;&#10;            &lt;thead&gt;&#10;              &lt;tr style={{ background: '#8da1bd' }}&gt;&#10;                &lt;th style={{ padding: 8, textAlign: 'left', fontWeight: 600 }}&gt;Sender&lt;/th&gt;&#10;                &lt;th style={{ padding: 8, textAlign: 'left', fontWeight: 600 }}&gt;Receiver&lt;/th&gt;&#10;                &lt;th style={{ padding: 8, textAlign: 'left', fontWeight: 600 }}&gt;Type&lt;/th&gt;&#10;                &lt;th style={{ padding: 8, textAlign: 'left', fontWeight: 600 }}&gt;Category&lt;/th&gt;&#10;                &lt;th style={{ padding: 8, textAlign: 'left', fontWeight: 600 }}&gt;Level&lt;/th&gt;&#10;                &lt;th style={{ padding: 8, textAlign: 'left', fontWeight: 600 }}&gt;Points&lt;/th&gt;&#10;                &lt;th style={{ padding: 8, textAlign: 'left', fontWeight: 600 }}&gt;Date&lt;/th&gt;&#10;              &lt;/tr&gt;&#10;            &lt;/thead&gt;&#10;            &lt;tbody&gt;&#10;              {recentRecognitions.length === 0 ? (&#10;                &lt;tr&gt;&lt;td colSpan={7} style={{ padding: 8, textAlign: 'center', color: '#888' }}&gt;No recent recognitions found.&lt;/td&gt;&lt;/tr&gt;&#10;              ) : recentRecognitions.map((row, idx) =&gt; {&#10;                const sender = row.senderName || '-';&#10;                const receiver = row.recipientName || '-';&#10;                const type = row.recognitionTypeName || '-';&#10;                const category = row.category || '-';&#10;                const level = row.level || '-';&#10;                const points = row.awardPoints != null ? row.awardPoints : '-';&#10;                let dateStr = '-';&#10;                if (row.sentAt) {&#10;                  try {&#10;                    const date = new Date(row.sentAt * 1000);&#10;                    dateStr = `${String(date.getDate()).padStart(2, '0')}/${String(date.getMonth() + 1).padStart(2, '0')}/${date.getFullYear()}`;&#10;                  } catch {&#10;                    dateStr = '-';&#10;                  }&#10;                }&#10;                return (&#10;                  &lt;tr key={idx} style={{ background: idx % 2 === 0 ? '#f5f7fa' : '#fff' }}&gt;&#10;                    &lt;td style={{ padding: 8 }}&gt;{sender}&lt;/td&gt;&#10;                    &lt;td style={{ padding: 8 }}&gt;{receiver}&lt;/td&gt;&#10;                    &lt;td style={{ padding: 8 }}&gt;{type}&lt;/td&gt;&#10;                    &lt;td style={{ padding: 8 }}&gt;{category}&lt;/td&gt;&#10;                    &lt;td style={{ padding: 8 }}&gt;{level}&lt;/td&gt;&#10;                    &lt;td style={{ padding: 8 }}&gt;{points}&lt;/td&gt;&#10;                    &lt;td style={{ padding: 8 }}&gt;{dateStr}&lt;/td&gt;&#10;                  &lt;/tr&gt;&#10;                );&#10;              })}&#10;            &lt;/tbody&gt;&#10;          &lt;/table&gt;&#10;        &lt;/div&gt;&#10;      &lt;/div&gt;&#10;    &lt;/div&gt;&#10;  );&#10;};&#10;&#10;export default Dashboard;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/scripts/test_import.sh">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/scripts/test_import.sh" />
              <option name="updatedContent" value="#!/usr/bin/env zsh&#10;set -euo pipefail&#10;&#10;BASE=${BASE:-http://localhost:8080}&#10;CSV=${CSV:-tmp/sample_import.csv}&#10;DEV=${DEV:-true}&#10;&#10;info() { echo &quot;[INFO] $1&quot;; }&#10;err() { echo &quot;[ERROR] $1&quot; &gt;&amp;2; }&#10;&#10;info &quot;Checking server health at $BASE/actuator/health&quot;&#10;if ! curl -sSf &quot;$BASE/actuator/health&quot; &gt;/dev/null; then&#10;  err &quot;Server is not up. Start with: SPRING_DATASOURCE_USERNAME=postgres SPRING_DATASOURCE_PASSWORD=rmkec ./gradlew bootRun -Dapp.dev.enabled=true&quot;&#10;  exit 1&#10;fi&#10;&#10;info &quot;Starting async import via /admin/imports using $CSV&quot;&#10;HTTP_CODE=$(curl -s -o /tmp/import_response.json -w &quot;%{http_code}&quot; -X POST -F &quot;file=@${CSV}&quot; &quot;$BASE/admin/imports&quot;)&#10;cat /tmp/import_response.json | jq . || cat /tmp/import_response.json || true&#10;if [[ &quot;$HTTP_CODE&quot; != &quot;202&quot; &amp;&amp; &quot;$HTTP_CODE&quot; != &quot;200&quot; ]]; then&#10;  err &quot;Import start failed, HTTP $HTTP_CODE&quot;&#10;  exit 2&#10;fi&#10;&#10;JOB_ID=$(jq -r '.jobId // .job_id // empty' /tmp/import_response.json 2&gt;/dev/null || true)&#10;if [[ -z &quot;$JOB_ID&quot; ]]; then&#10;  err &quot;No jobId returned in response. Check /tmp/import_response.json&quot;&#10;  exit 3&#10;fi&#10;info &quot;jobId=$JOB_ID&quot;&#10;&#10;info &quot;Polling job status at /admin/imports/$JOB_ID&quot;&#10;for i in {1..30}; do&#10;  STATUS_JSON=$(curl -s &quot;$BASE/admin/imports/$JOB_ID&quot;)&#10;  STATUS=$(echo &quot;$STATUS_JSON&quot; | jq -r '.status // empty' 2&gt;/dev/null || true)&#10;  echo &quot;$STATUS_JSON&quot; | jq . || echo &quot;$STATUS_JSON&quot;&#10;  if [[ &quot;$STATUS&quot; == &quot;SUCCESS&quot; || &quot;$STATUS&quot; == &quot;PARTIAL&quot; || &quot;$STATUS&quot; == &quot;FAILED&quot; ]]; then&#10;    break&#10;  fi&#10;  sleep 1&#10;done&#10;&#10;info &quot;Fetching errors JSON at /admin/imports/$JOB_ID/errors&quot;&#10;curl -s &quot;$BASE/admin/imports/$JOB_ID/errors?page=0&amp;size=50&quot; | jq . || true&#10;&#10;info &quot;Downloading errors CSV at /admin/imports/$JOB_ID/errors/csv&quot;&#10;curl -s &quot;$BASE/admin/imports/$JOB_ID/errors/csv&quot; -o &quot;import_errors_${JOB_ID}.csv&quot; || true&#10;ls -l &quot;import_errors_${JOB_ID}.csv&quot; || true&#10;&#10;info &quot;Done.&quot;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/org/example/controller/AdminV1Controller.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/org/example/controller/AdminV1Controller.java" />
              <option name="originalContent" value="package org.example.controller;&#10;&#10;import org.example.service.StagingImportService;&#10;import org.springframework.beans.factory.annotation.Value;&#10;import org.springframework.http.ResponseEntity;&#10;import org.springframework.web.bind.annotation.*;&#10;import org.springframework.web.multipart.MultipartFile;&#10;&#10;import java.util.Map;&#10;&#10;@RestController&#10;@RequestMapping(&quot;/api/v1/admin&quot;)&#10;public class AdminV1Controller {&#10;&#10;    private final StagingImportService stagingImportService;&#10;    private final boolean devEnabled;&#10;&#10;    public AdminV1Controller(StagingImportService stagingImportService, @Value(&quot;${app.dev.enabled:false}&quot;) boolean devEnabled) {&#10;        this.stagingImportService = stagingImportService;&#10;        this.devEnabled = devEnabled;&#10;    }&#10;&#10;    @PostMapping(&quot;/imports&quot;)&#10;    public ResponseEntity&lt;?&gt; startImport(@RequestParam MultipartFile file) {&#10;        if (!devEnabled) return ResponseEntity.status(403).body(Map.of(&quot;error&quot;, &quot;admin import disabled&quot;));&#10;        try {&#10;            Map&lt;String, Object&gt; res = stagingImportService.startImportViaCopyAsync(file, file.getOriginalFilename());&#10;            return ResponseEntity.accepted().body(res);&#10;        } catch (Exception e) {&#10;            return ResponseEntity.status(500).body(Map.of(&quot;error&quot;, e.getMessage()));&#10;        }&#10;    }&#10;&#10;    @GetMapping(&quot;/imports/{jobId}&quot;)&#10;    public ResponseEntity&lt;?&gt; getImportStatus(@PathVariable Long jobId) {&#10;        if (!devEnabled) return ResponseEntity.status(403).body(Map.of(&quot;error&quot;, &quot;admin import disabled&quot;));&#10;        try {&#10;            Map&lt;String, Object&gt; status = stagingImportService.getImportJobStatus(jobId);&#10;            return ResponseEntity.ok(status);&#10;        } catch (Exception e) {&#10;            return ResponseEntity.status(500).body(Map.of(&quot;error&quot;, e.getMessage()));&#10;        }&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package org.example.controller;&#10;&#10;// Deprecated stub. Use AdminController (/admin) for admin endpoints.&#10;public class AdminV1Controller {&#10;    // deprecated&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/org/example/controller/RecognitionV1Controller.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/org/example/controller/RecognitionV1Controller.java" />
              <option name="originalContent" value="package org.example.controller;&#10;&#10;import org.example.dto.RecognitionResponse;&#10;import org.example.dto.StatusUpdateRequest;&#10;import org.example.model.Recognition;&#10;import org.example.model.Employee;&#10;import org.example.repository.EmployeeRepository;&#10;import org.example.repository.RecognitionRepository;&#10;import org.example.service.RecognitionCsvExporter;&#10;import org.example.util.EntityMapper;&#10;import org.springframework.data.domain.Page;&#10;import org.springframework.data.domain.PageRequest;&#10;import org.springframework.data.domain.Pageable;&#10;import org.springframework.http.HttpHeaders;&#10;import org.springframework.http.MediaType;&#10;import org.springframework.http.ResponseEntity;&#10;import org.springframework.web.bind.annotation.*;&#10;import org.springframework.web.servlet.mvc.method.annotation.StreamingResponseBody;&#10;&#10;import java.io.OutputStream;&#10;import java.util.List;&#10;import java.util.Optional;&#10;import java.util.UUID;&#10;import java.util.stream.Collectors;&#10;&#10;@RestController&#10;@RequestMapping(&quot;/api/v1/recognitions&quot;)&#10;public class RecognitionV1Controller {&#10;&#10;    private final RecognitionRepository recognitionRepository;&#10;    private final EmployeeRepository employeeRepository;&#10;    private final RecognitionCsvExporter csvExporter;&#10;&#10;    public RecognitionV1Controller(RecognitionRepository recognitionRepository, EmployeeRepository employeeRepository, RecognitionCsvExporter csvExporter) {&#10;        this.recognitionRepository = recognitionRepository;&#10;        this.employeeRepository = employeeRepository;&#10;        this.csvExporter = csvExporter;&#10;    }&#10;&#10;    @GetMapping&#10;    public Page&lt;RecognitionResponse&gt; list(@RequestParam(defaultValue = &quot;0&quot;) int page,&#10;                                         @RequestParam(defaultValue = &quot;20&quot;) int size,&#10;                                         @RequestParam(required = false) Long senderId,&#10;                                         @RequestParam(required = false) UUID senderUuid,&#10;                                         @RequestParam(required = false) Long recipientId,&#10;                                         @RequestParam(required = false) UUID recipientUuid) {&#10;        Pageable p = PageRequest.of(page, size);&#10;&#10;        // prefer uuid if provided&#10;        if (senderUuid != null) {&#10;            Optional&lt;java.util.UUID&gt; su = Optional.of(senderUuid);&#10;            List&lt;Employee&gt; senders = employeeRepository.findAllByUuidIn(List.of(senderUuid)).stream().collect(Collectors.toList());&#10;            if (!senders.isEmpty()) {&#10;                return recognitionRepository.findAllBySenderId(senders.get(0).getId(), p).map(EntityMapper::toRecognitionResponse);&#10;            }&#10;        }&#10;        if (recipientUuid != null) {&#10;            List&lt;Employee&gt; recs = employeeRepository.findAllByUuidIn(List.of(recipientUuid)).stream().collect(Collectors.toList());&#10;            if (!recs.isEmpty()) {&#10;                return recognitionRepository.findAllByRecipientId(recs.get(0).getId(), p).map(EntityMapper::toRecognitionResponse);&#10;            }&#10;        }&#10;&#10;        if (senderId != null) return recognitionRepository.findAllBySenderId(senderId, p).map(EntityMapper::toRecognitionResponse);&#10;        if (recipientId != null) return recognitionRepository.findAllByRecipientId(recipientId, p).map(EntityMapper::toRecognitionResponse);&#10;&#10;        return recognitionRepository.findAllWithRelations(p).map(EntityMapper::toRecognitionResponse);&#10;    }&#10;&#10;    @GetMapping(&quot;/{uuid}&quot;)&#10;    public ResponseEntity&lt;?&gt; getByUuid(@PathVariable UUID uuid) {&#10;        Optional&lt;Recognition&gt; r = recognitionRepository.findByUuidWithRelations(uuid);&#10;        return r.map(rec -&gt; ResponseEntity.ok(EntityMapper.toRecognitionResponse(rec))).orElseGet(() -&gt; ResponseEntity.notFound().build());&#10;    }&#10;&#10;    // backward-compatible: allow id query&#10;    @GetMapping(params = &quot;id&quot;)&#10;    public ResponseEntity&lt;?&gt; getById(@RequestParam Long id) {&#10;        Optional&lt;Recognition&gt; r = recognitionRepository.findByIdWithRelations(id);&#10;        return r.map(rec -&gt; ResponseEntity.ok(EntityMapper.toRecognitionResponse(rec))).orElseGet(() -&gt; ResponseEntity.notFound().build());&#10;    }&#10;&#10;    @PatchMapping(&quot;/{uuid}/status&quot;)&#10;    public ResponseEntity&lt;?&gt; updateStatus(@PathVariable UUID uuid, @RequestBody StatusUpdateRequest req) {&#10;        Optional&lt;Recognition&gt; opt = recognitionRepository.findByUuidWithRelations(uuid);&#10;        if (opt.isEmpty()) return ResponseEntity.notFound().build();&#10;        Recognition r = opt.get();&#10;        String desired = req != null ? req.status : null;&#10;        if (desired == null) return ResponseEntity.badRequest().body(java.util.Map.of(&quot;error&quot;, &quot;status is required&quot;));&#10;        String upper = desired.toUpperCase();&#10;        if (&quot;APPROVED&quot;.equals(upper)) {&#10;            r.setApprovalStatus(&quot;APPROVED&quot;);&#10;            r.setRejectionReason(null); // clear rejectionReason on approve&#10;        } else if (&quot;REJECTED&quot;.equals(upper)) {&#10;            if (req.rejectionReason == null || req.rejectionReason.isBlank()) return ResponseEntity.badRequest().body(java.util.Map.of(&quot;error&quot;, &quot;rejectionReason required for REJECTED status&quot;));&#10;            r.setApprovalStatus(&quot;REJECTED&quot;);&#10;            r.setRejectionReason(req.rejectionReason);&#10;        } else if (&quot;PENDING&quot;.equals(upper)) {&#10;            r.setApprovalStatus(&quot;PENDING&quot;);&#10;        } else {&#10;            return ResponseEntity.badRequest().body(java.util.Map.of(&quot;error&quot;, &quot;unknown status&quot;));&#10;        }&#10;        recognitionRepository.save(r);&#10;        Recognition reloaded = recognitionRepository.findByUuidWithRelations(r.getUuid()).orElse(r);&#10;        return ResponseEntity.ok(EntityMapper.toRecognitionResponse(reloaded));&#10;    }&#10;&#10;    @GetMapping(&quot;/export&quot;)&#10;    public ResponseEntity&lt;?&gt; export(@RequestParam(defaultValue = &quot;json&quot;) String format,&#10;                                    @RequestParam(defaultValue = &quot;false&quot;) boolean stream,&#10;                                    @RequestParam(required = false) UUID recipientUuid,&#10;                                    @RequestParam(required = false) Long recipientId) throws Exception {&#10;        List&lt;Recognition&gt; list;&#10;        if (recipientUuid != null) {&#10;            List&lt;Employee&gt; recs = employeeRepository.findAllByUuidIn(List.of(recipientUuid));&#10;            if (!recs.isEmpty()) list = recognitionRepository.findAllByRecipientId(recs.get(0).getId(), Pageable.unpaged()).getContent();&#10;            else list = List.of();&#10;        } else if (recipientId != null) {&#10;            list = recognitionRepository.findAllByRecipientId(recipientId, Pageable.unpaged()).getContent();&#10;        } else {&#10;            list = recognitionRepository.findAllWithRelations(Pageable.unpaged()).getContent();&#10;        }&#10;&#10;        if (&quot;csv&quot;.equalsIgnoreCase(format)) {&#10;            if (stream) {&#10;                StreamingResponseBody s = (OutputStream os) -&gt; {&#10;                    try {&#10;                        csvExporter.exportToStream(os, list);&#10;                    } catch (Exception ex) {&#10;                        throw new RuntimeException(ex);&#10;                    }&#10;                };&#10;                return ResponseEntity.ok()&#10;                        .header(HttpHeaders.CONTENT_DISPOSITION, &quot;attachment; filename=recognitions.csv&quot;)&#10;                        .contentType(MediaType.parseMediaType(&quot;text/csv&quot;))&#10;                        .body(s);&#10;            } else {&#10;                byte[] bytes = csvExporter.export(list);&#10;                return ResponseEntity.ok()&#10;                        .header(HttpHeaders.CONTENT_DISPOSITION, &quot;attachment; filename=recognitions.csv&quot;)&#10;                        .contentType(MediaType.parseMediaType(&quot;text/csv&quot;))&#10;                        .body(bytes);&#10;            }&#10;        } else {&#10;            List&lt;RecognitionResponse&gt; resp = list.stream().map(EntityMapper::toRecognitionResponse).collect(Collectors.toList());&#10;            return ResponseEntity.ok(resp);&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package org.example.controller;&#10;&#10;// This controller was a v1 prototype and is now deprecated. The canonical endpoints are served by `RecognitionController` at `/recognitions`.&#10;// Kept intentionally empty to avoid duplicate bean registration.&#10;&#10;public class RecognitionV1Controller {&#10;    // deprecated stub&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>